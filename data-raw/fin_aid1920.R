## code to prepare `fin_aid1920` dataset goes here

library(tidyverse)

temp <- tempfile()
download.file("https://nces.ed.gov/ipeds/datacenter/data/SFA1920.zip", temp)
fin_aid1920 <- read.table(unz(temp, "sfa1920.csv"), sep = ",", header = TRUE)

fin_aid1920 <- fin_aid1920 %>%
  select(-starts_with("X")) %>%
  select(UNITID, SCFY2, UAGRNTP, UAGRNTA, UPGRNTA, UFLOANA, AGRNT_A, FGRNT_A, PGRNT_A,
         OFGRT_A, SGRNT_A, IGRNT_A, LOAN_A, FLOAN_A, OLOAN_A, GISTA2, GISTA1, GISTA0,
         GIS4A2, GIS4A12, GIS4A22, GIS4A32, GIS4A42, GIS4A52, GIS4A1, GIS4A11, GIS4A21,
         GIS4A31, GIS4A41, GIS4A51, GIS4A0, GIS4A10, GIS4A20, GIS4A30, GIS4A40, GIS4A50,
         NPIST2, NPIST1, NPIST0, NPIS412, NPIS422, NPIS432, NPIS442, NPIS452, NPIS411,
         NPIS421, NPIS431, NPIS441, NPIS451, NPIS410, NPIS420, NPIS430, NPIS440, NPIS450,
         GRNTA0, GRN4A2, GRN4A12, GRN4A22, GRN4A32, GRN4A42, GRN4A52, GRN4A1, GRN4A11,
         GRN4A21, GRN4A31, GRN4A41, GRN4A51, GRN4A0, GRN4A10, GRN4A20, GRN4A30, GRN4A40,
         GRN4A50, NPGRN2, NPGRN1, NPGRN0, NPT412, NPT422, NPT432, NPT442, NPT452, NPT411,
         NPT421, NPT431, NPT441, NPT451, NPT410, NPT420, NPT430, NPT440, NPT450)


fin_aid1920 <- fin_aid1920 %>%
  rename(
    INSTITUTION_ID = UNIT_ID,
    UG_NUM = SCFY2,
    PCT_AID = UAGRNTP,
    AVG_AID = UAGRNTA,
    AVG_PELL = UPGRNTA,
    AVG_FLOAN = UFLOANA,
    AVG_AWRD = AGRNT_A,

    AVG_FGRANT_FTFT = FGRNT_A,
    AVG_PGRANT_FTFT = PGRNT_A,
    AVG_FOTHER_FTFT = OFGRT_A,
    AVG_STGRANT_FTFT = SGRNT_A,
    AVG_INST_AID_FTFT = IGRNT_A,
    AVG_LOAN_FTFT = LOAN_A,
    AVG_FLOAN_FTFT = FLOAN_A,
    AVG_OLOAN_FTFT = OLOAN_A,

    IS_AVG_GAID_1920 = GISTA2,
    IS_AVG_GAID_1819 = GISTA1,
    IS_AVG_GAID_1718 = GISTA0,

    AVG_AID_AL_1920 = GIS4A2,
    AVG_AID_L1_1920 = GIS4A12,
    AVG_AID_L2_1920 = GIS4A22,
    AVG_AID_L3_1920 = GIS4A32,
    AVG_AID_L4_1920 = GIS4A42,
    AVG_AID_L5_1920 = GIS4A52,

    AVG_AID_AL_1819 = GIS4A1,
    AVG_AID_L1_1819 = GIS4A11,
    AVG_AID_L2_1819 = GIS4A21,
    AVG_AID_L3_1819 = GIS4A31,
    AVG_AID_L4_1819 = GIS4A41,
    AVG_AID_L5_1819 = GIS4A51,

    AVG_AID_AL_1718 = GIS4A0,
    AVG_AID_L1_1718 = GIS4A10,
    AVG_AID_L2_1718 = GIS4A20,
    AVG_AID_L3_1718 = GIS4A30,
    AVG_AID_L4_1718 = GIS4A40,
    AVG_AID_L5_1718 = GIS4A50,

    AVG_NPRICE_1920 = NPIST2,
    AVG_NPRICE_1819 = NPIST1,
    AVG_NPRICE_1718 = NPIST0,

    AVG_NPRICE_L1_1920 = NPIS412,
    AVG_NPRICE_L2_1920 = NPIS422,
    AVG_NPRICE_L3_1920 = NPIS432,
    AVG_NPRICE_L4_1920 = NPIS442,
    AVG_NPRICE_L5_1920 = NPIS452,

    AVG_NPRICE_L1_1819 = NPIS411,
    AVG_NPRICE_L2_1819 = NPIS421,
    AVG_NPRICE_L3_1819 = NPIS431,
    AVG_NPRICE_L4_1819 = NPIS441,
    AVG_NPRICE_L5_1819 = NPIS451,

    AVG_NPRICE_L1_1718 = NPIS410,
    AVG_NPRICE_L2_1718 = NPIS420,
    AVG_NPRICE_L3_1718 = NPIS430,
    AVG_NPRICE_L4_1718 = NPIS440,
    AVG_NPRICE_L5_1718 = NPIS450,

    OS_AVG_GAID_1718 = GRNTA0,

    OS_AVG_GAID_AL_1920 = GRN4A2,
    OS_AVG_GAID_L1_1920 = GRN4A12,
    OS_AVG_GAID_L2_1920 = GRN4A22,
    OS_AVG_GAID_L3_1920 = GRN4A32,
    OS_AVG_GAID_L4_1920 = GRN4A42,
    OS_AVG_GAID_L5_1920 = GRN4A52,

    OS_AVG_GAID_AL_1819 = GRN4A1,
    OS_AVG_GAID_L1_1819 = GRN4A11,
    OS_AVG_GAID_L2_1819 = GRN4A21,
    OS_AVG_GAID_L3_1819 = GRN4A31,
    OS_AVG_GAID_L4_1819 = GRN4A41,
    OS_AVG_GAID_L5_1819 = GRN4A51,

    OS_AVG_GAID_AL_1718 = GRN4A0,
    OS_AVG_GAID_L1_1718 = GRN4A10,
    OS_AVG_GAID_L2_1718 = GRN4A20,
    OS_AVG_GAID_L3_1718 = GRN4A30,
    OS_AVG_GAID_L4_1718 = GRN4A40,
    OS_AVG_GAID_L5_1718 = GRN4A50,

    OS_AVG_NPRICE_1920 = NPGRN2,
    OS_AVG_NPRICE_1819 = NPGRN1,
    OS_AVG_NPRICE_1718 = NPGRN0,

    OS_AVG_NPRICE_L1_1920 = NPT412,
    OS_AVG_NPRICE_L2_1920 = NPT422,
    OS_AVG_NPRICE_L3_1920 = NPT432,
    OS_AVG_NPRICE_L4_1920 = NPT442,
    OS_AVG_NPRICE_L5_1920 = NPT452,

    OS_AVG_NPRICE_L1_1819 = NPT411,
    OS_AVG_NPRICE_L2_1819 = NPT421,
    OS_AVG_NPRICE_L3_1819 = NPT431,
    OS_AVG_NPRICE_L4_1819 = NPT441,
    OS_AVG_NPRICE_L5_1819 = NPT451,

    OS_AVG_NPRICE_L1_1718 = NPT410,
    OS_AVG_NPRICE_L2_1718 = NPT420,
    OS_AVG_NPRICE_L3_1718 = NPT430,
    OS_AVG_NPRICE_L4_1718 = NPT440,
    OS_AVG_NPRICE_L5_1718 = NPT450
  )

unlink(temp)

usethis::use_data(fin_aid1920, overwrite = TRUE)
